name: Pull Request

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  validate:
    name: Validate
    uses: ./.github/workflows/validate.yml
    permissions:
      contents: read
      checks: write

  label:
    name: Label
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - uses: srvaroa/labeler@v1.14.0
        env:
          GITHUB_TOKEN: ${{ github.token }}

  pr-size:
    name: PR Size Check
    # Skip size check for feature integration branches (NNN-*/base) merging to main
    # (NNN-feature/base â†’ main aggregates all phases, expected to be large)
    if: >-
      !(
        github.event.pull_request.base.ref == 'main' &&
        endsWith(github.event.pull_request.head.ref, '/base') &&
        (
          startsWith(github.event.pull_request.head.ref, '0') ||
          startsWith(github.event.pull_request.head.ref, '1') ||
          startsWith(github.event.pull_request.head.ref, '2') ||
          startsWith(github.event.pull_request.head.ref, '3') ||
          startsWith(github.event.pull_request.head.ref, '4') ||
          startsWith(github.event.pull_request.head.ref, '5') ||
          startsWith(github.event.pull_request.head.ref, '6') ||
          startsWith(github.event.pull_request.head.ref, '7') ||
          startsWith(github.event.pull_request.head.ref, '8') ||
          startsWith(github.event.pull_request.head.ref, '9')
        )
      )
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - uses: ookami-kb/gh-pr-size-watcher@v1.5.0
        with:
          githubToken: ${{ secrets.GITHUB_TOKEN }}
          errorSize: 750
          errorMessage: ':no_entry: PR has more than **{allowed} additions**. Split it into smaller PRs.'
          warningSize: 333
          warningMessage: ':warning: PR has more than **{allowed} additions**. Consider splitting it into smaller PRs.'
          excludeLabels: |
            allow-large-pr
          excludePaths: |
            *.md
            specs/**
            features/*.feature
            .specify/**
            .claude/**
