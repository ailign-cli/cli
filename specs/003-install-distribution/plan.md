# Implementation Plan: Install & Distribution

**Branch**: `003-install-distribution` | **Date**: 2026-02-17 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/003-install-distribution/spec.md`

## Summary

Extend the existing GoReleaser configuration to distribute ailign via all major package managers (Homebrew, Scoop, WinGet, Chocolatey, Snapcraft, AUR, Nix, Docker, nFPM), create a universal install script, build an NPM wrapper package, and write comprehensive installation documentation. The existing release pipeline already builds cross-platform binaries — this feature adds distribution channels.

## Technical Context

**Language/Version**: Go 1.24+ (existing), POSIX shell (install script), Node.js (NPM wrapper)
**Primary Dependencies**: GoReleaser v2.13+ (existing), GitHub Actions
**Storage**: N/A (distribution only — no data persistence)
**Testing**: BDD scenarios via godog (locally-testable install flows + `@ci`-tagged post-release smoke tests), shellcheck for install.sh, npm package smoke tests
**Target Platform**: macOS (amd64, arm64), Linux (amd64, arm64), Windows (amd64)
**Project Type**: Configuration + scripts (minimal Go code changes)
**Performance Goals**: Install completes in <30 seconds (excluding download)
**Constraints**: GoReleaser OSS only (no Pro features — DMG deferred)

## Constitution Check

| Principle | Status | Notes |
|-----------|--------|-------|
| I. CLI-First | PASS | Binary distribution serves CLI-first goal |
| II. Transparency | PASS | Install script shows what it's doing, checksum verification |
| III. Fail Safe | PASS | Checksum verification, clear error messages in install script |
| IV. Test-First | PASS | Install script tested via BDD scenarios |
| V. Composition | PASS | Each distribution channel is independent |
| VI. Governance | PASS | Versioned releases, checksums, immutable packages |
| VII. Size-Aware | N/A | No content rendering in this feature |
| VIII. Cross-Tool Parity | N/A | No AI tool interaction in this feature |
| IX. Working Software | PASS | Each PR adds a working distribution channel |

## Project Structure

### Documentation (this feature)

```text
specs/003-install-distribution/
├── plan.md              # This file
├── research.md          # Distribution research findings
├── spec.md              # Feature specification
├── checklists/
│   └── requirements.md  # Spec quality checklist
└── tasks.md             # Task breakdown (generated by /speckit.tasks)

features/                # BDD feature files
├── install-via-homebrew.feature
├── install-via-go.feature
├── install-via-binary.feature
└── install-documentation.feature
```

### Source Code (repository root)

```text
# GoReleaser configuration (existing, extended)
.goreleaser.yml                    # Extended with distribution targets

# Install script (new)
install.sh                         # Universal POSIX install script

# Docker (new)
Dockerfile                         # Minimal container image

# NPM wrapper package (new)
npm/
├── ailign/                        # @ailign/cli main wrapper
│   ├── package.json
│   ├── bin/
│   │   └── ailign                 # CLI shim (Node.js)
│   ├── lib/
│   │   └── platform.js            # Platform detection + binary resolution
│   └── scripts/
│       └── install.js             # Postinstall fallback downloader
├── ailign-darwin-arm64/           # Platform-specific packages
│   └── package.json
├── ailign-darwin-x64/
│   └── package.json
├── ailign-linux-x64/
│   └── package.json
├── ailign-linux-arm64/
│   └── package.json
└── ailign-win32-x64/
    └── package.json

# CI/CD (existing, extended)
.github/workflows/
└── release.yml                    # Extended with docker login + npm publish job

# Documentation (existing, updated)
README.md                          # Updated with installation section
```

**Structure Decision**: Distribution is primarily configuration (GoReleaser YAML, Dockerfile, npm package.json files) with a single shell script and minimal Node.js glue code. No new Go packages needed.

## PR Decomposition

| PR  | Scope                                   | Est. Lines | Independently Deployable? |
|-----|-----------------------------------------|-----------|---------------------------|
| PR 1 | Version command + install script        | ~200       | Yes — `ailign --version` works, install.sh functional |
| PR 2 | GoReleaser Tier 1 (Homebrew, Scoop, nFPM) | ~150    | Yes — packages published on next release |
| PR 3 | GoReleaser Tier 2 (Nix, Docker, WinGet) | ~150 | Yes — additional channels on next release (AUR, Chocolatey, Snapcraft deferred to Phase 8) |
| PR 4 | NPM wrapper package + publish workflow  | ~300       | Yes — `npx @ailign/cli` works |
| PR 5 | README installation documentation       | ~150       | Yes — docs complete |

**Splitting strategy**: By distribution channel tier. Each PR adds independently functional distribution methods. Tier 2 channels that require external accounts can be stubbed with commented-out config and enabled as accounts are created.

## Complexity Tracking

No constitution violations. All PRs are configuration + documentation with minimal code.
